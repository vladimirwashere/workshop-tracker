<% content_for(:title) { @worker.full_name } %>

<div class="max-w-7xl mx-auto">
  <div class="mb-6">
    <%= render "shared/back_link", fallback: workers_path %>
    <div class="flex items-center justify-between mt-2">
      <div>
        <h1 class="page-title"><%= @worker.full_name %></h1>
        <p class="text-sm text-slate-500 mt-1"><%= @worker.trade %></p>
      </div>
      <% if policy(@worker).update? %>
        <div class="flex items-center gap-2">
          <%= link_to t("common.edit"), edit_worker_path(@worker),
            class: "btn-secondary",
            aria: { label: "#{t('common.edit')} #{@worker.full_name}" } %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="glass-card p-6 mb-6">
    <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
      <div>
        <dt class="text-sm font-medium text-slate-500"><%= t("workers.full_name") %></dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @worker.full_name %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500"><%= t("workers.trade") %></dt>
        <dd class="mt-1 text-sm text-slate-900"><%= @worker.trade.present? ? @worker.trade : "&mdash;".html_safe %></dd>
      </div>
      <div>
        <dt class="text-sm font-medium text-slate-500"><%= t("workers.active") %></dt>
        <dd class="mt-1"><%= active_badge(@worker.active) %></dd>
      </div>
      <% if @can_view_salary && @current_salary %>
        <div>
          <dt class="text-sm font-medium text-slate-500"><%= t("workers.current_salary") %></dt>
          <dd class="mt-1 text-sm text-slate-900"><%= format_currency(@current_salary.gross_monthly_ron, date: @current_salary.effective_from) %></dd>
        </div>
      <% end %>
      <% if @worker.notes.present? %>
        <div class="sm:col-span-2">
          <dt class="text-sm font-medium text-slate-500"><%= t("workers.notes") %></dt>
          <dd class="mt-1 text-sm text-slate-900 whitespace-pre-wrap"><%= @worker.notes %></dd>
        </div>
      <% end %>
    </dl>
  </div>

  <% if @can_view_salary %>
    <div class="glass-card-flush">
      <div class="flex items-center justify-between px-6 py-4 border-b border-slate-200/50">
        <h2 class="section-title"><%= t("workers.salary_history") %></h2>
        <% if policy(WorkerSalary).create? %>
          <%= link_to t("worker_salaries.new_title"), new_worker_worker_salary_path(@worker),
            class: "btn-primary btn-sm" %>
        <% end %>
      </div>

      <% if @salary_history&.any? %>
        <div class="overflow-x-auto">
          <table class="table-premium" role="table">
            <thead>
              <tr>
                <th><%= t("worker_salaries.effective_from") %></th>
                <th><%= t("worker_salaries.gross_monthly") %></th>
                <th><%= t("worker_salaries.net_monthly") %></th>
                <th><%= t("worker_salaries.daily_rate") %></th>
                <th class="text-right"><%= t("common.actions") %></th>
              </tr>
            </thead>
            <tbody>
              <% @salary_history.each do |salary| %>
                <tr>
                  <td class="text-slate-700"><%= format_date(salary.effective_from) %></td>
                  <td class="text-slate-600"><%= format_currency(salary.gross_monthly_ron, date: salary.effective_from) %></td>
                  <td class="text-slate-600"><%= format_currency(salary.net_monthly_ron, date: salary.effective_from) %></td>
                  <td class="text-slate-600"><%= format_currency(salary.derived_daily_rate_ron, date: salary.effective_from) %></td>
                  <td class="text-right space-x-2">
                    <% if policy(salary).update? %>
                      <%= link_to t("common.edit"), edit_worker_worker_salary_path(@worker, salary),
                        class: "link-primary text-sm hover:underline" %>
                    <% end %>
                    <% if policy(salary).destroy? %>
                      <%= button_to t("common.delete"), worker_worker_salary_path(@worker, salary),
                        method: :delete,
                        form: { data: { turbo_confirm: t("common.confirm_delete") } },
                        class: "link-danger text-sm hover:underline" %>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="p-6">
          <p class="text-sm text-slate-500"><%= t("common.no_records") %></p>
        </div>
      <% end %>
    </div>
  <% end %>



</div>
