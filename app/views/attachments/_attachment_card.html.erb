<div class="group relative glass-card-hover overflow-hidden">
  <% if attachment.image? && attachment.file.attached? %>
    <div class="aspect-square bg-slate-100 cursor-pointer"
         data-action="click->lightbox#open"
         data-lightbox-index-param="<%= index %>"
         data-lightbox-src-param="<%= rails_blob_path(attachment.file, disposition: "inline") %>"
         data-lightbox-alt-param="<%= attachment.file_name %>">
      <%= image_tag attachment.thumbnail, alt: attachment.file_name,
            class: "w-full h-full object-cover",
            loading: "lazy" %>
    </div>
  <% else %>
    <a href="<%= download_attachment_path(attachment) %>"
       class="aspect-square bg-slate-50/50 flex flex-col items-center justify-center p-4">
      <div class="h-12 w-12 flex items-center justify-center rounded-xl bg-slate-100/80 text-slate-500 mb-2">
        <% if attachment.document? && attachment.mime_type == "application/pdf" %>
          <svg class="h-7 w-7 text-red-500" fill="currentColor" viewBox="0 0 24 24">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zM6 20V4h7v5h5v11H6z"/>
            <text x="8" y="17" font-size="6" font-weight="bold" fill="currentColor">PDF</text>
          </svg>
        <% elsif attachment.raw_image? %>
          <svg class="h-7 w-7 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                  d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" />
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                  d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" />
          </svg>
        <% else %>
          <svg class="h-7 w-7 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                  d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
          </svg>
        <% end %>
      </div>
      <span class="text-xs text-slate-500 uppercase font-medium">
        <%= attachment.file_name.split(".").last&.upcase %>
      </span>
    </a>
  <% end %>

  <div class="px-3 py-2 border-t border-slate-100">
    <p class="text-xs font-medium text-slate-700 break-words" title="<%= attachment.file_name %>">
      <%= attachment.file_name %>
    </p>
    <p class="text-xs text-slate-400 mt-0.5">
      <%= number_to_human_size(attachment.file_size) if attachment.file_size %>
    </p>
  </div>

  <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1">
    <% if policy(attachment).download? %>
      <%= link_to download_attachment_path(attachment),
            class: "p-1.5 bg-white/90 backdrop-blur-sm rounded-full shadow-sm hover:bg-white text-slate-600 hover:text-indigo-600 transition-colors",
            title: t("attachments.download"),
            aria: { label: "#{t('attachments.download')} #{attachment.file_name}" } do %>
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
      <% end %>
    <% end %>

    <% if policy(attachment).destroy? %>
      <%= button_to attachment_path(attachment), method: :delete,
            form: { data: { turbo_confirm: t("common.confirm_delete") } },
            class: "p-1.5 bg-white/90 backdrop-blur-sm rounded-full shadow-sm hover:bg-white text-slate-600 hover:text-red-600 transition-colors",
            title: t("common.delete"),
            aria: { label: "#{t('common.delete')} #{attachment.file_name}" } do %>
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      <% end %>
    <% end %>
  </div>
</div>
