<% content_for(:title) { t("projects.title") } %>

<div class="max-w-7xl mx-auto">
  <div class="flex items-center justify-between mb-6">
    <h1 class="page-title"><%= t("projects.title") %></h1>
    <% if can_manage? %>
      <%= link_to t("projects.new_title"), new_project_path,
        class: "btn-primary",
        aria: { label: t("projects.new_title") } %>
    <% end %>
  </div>

  <div class="glass-card p-4 mb-6">
    <form action="<%= projects_path %>" method="get" class="flex items-center gap-4" role="search" aria-label="<%= t('common.filter') %>" data-controller="auto-submit">
      <label for="status_filter" class="label-premium"><%= t("common.status") %></label>
      <select name="status" id="status_filter"
              class="select-premium"
              aria-label="<%= t('projects.status') %>"
              data-action="change->auto-submit#submit">
        <option value=""><%= t("common.filter") %> â€” All</option>
        <% Project.statuses.keys.each do |s| %>
          <option value="<%= s %>" <%= "selected" if params[:status] == s %>><%= t("projects.statuses.#{s}") %></option>
        <% end %>
      </select>
    </form>
  </div>

  <div class="glass-card-flush">
    <% if @projects.any? %>
      <div class="overflow-x-auto">
        <table class="table-premium" role="table">
          <thead>
            <tr>
              <th><%= t("projects.name") %></th>
              <th><%= t("projects.client_name") %></th>
              <th><%= t("projects.status") %></th>
              <th><%= t("projects.start_date") %></th>
              <th><%= t("projects.end_date") %></th>
              <th class="text-right"><%= t("common.actions") %></th>
            </tr>
          </thead>
          <tbody>
            <% @projects.each do |project| %>
              <tr>
                <td>
                  <%= link_to project.name, project_path(project), class: "link-primary font-medium" %>
                </td>
                <td class="text-slate-700"><%= project.client_name %></td>
                <td><%= status_badge(project.status) %></td>
                <td class="text-slate-500"><%= format_date(project.planned_start_date) %></td>
                <td class="text-slate-500"><%= format_date(project.planned_end_date) %></td>
                <td class="text-right space-x-2">
                  <%= link_to t("common.edit"), edit_project_path(project),
                    class: "link-primary text-sm",
                    aria: { label: "#{t('common.edit')} #{project.name}" } if policy(project).update? %>
                  <% if policy(project).destroy? %>
                    <%= button_to t("common.delete"), project_path(project), method: :delete,
                      class: "link-danger text-sm",
                      form: { data: { turbo_confirm: t("common.confirm_delete") } },
                      aria: { label: "#{t('common.delete')} #{project.name}" } %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="p-6">
        <p class="text-sm text-slate-500"><%= t("common.no_records") %></p>
      </div>
    <% end %>
  </div>
</div>
